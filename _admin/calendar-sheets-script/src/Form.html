<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <style>
      body { padding: 20px; font-family: sans-serif; }
      .form-label { font-weight: bold; font-size: 0.9rem; margin-bottom: 2px; }
      .mb-3 { margin-bottom: 1rem !important; }
    </style>
  </head>
  <body>
    <form id="eventForm">
      <div class="mb-3">
        <label class="form-label">Tapahtuman nimi *</label>
        <input type="text" name="title" class="form-control form-control-sm" required>
      </div>
      
      <div class="row mb-3">
        <div class="col">
          <label class="form-label">Alkupäivä *</label>
          <input type="date" name="start_date" class="form-control form-control-sm" required>
        </div>
        <div class="col">
          <label class="form-label">Loppupäivä</label>
          <input type="date" name="end_date" class="form-control form-control-sm">
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Kuvaus</label>
        <textarea name="description" class="form-control form-control-sm" rows="3"></textarea>
        <div class="form-text small">
          <strong>Muotoilu:</strong>
          <span>
            <code>*kursiivi*</code>, <code>**lihavointi**</code>, <code>[linkki](https://...)</code>.
          </span>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Linkki (URL)</label>
        <input type="url" name="url" class="form-control form-control-sm" placeholder="https://...">
      </div>

      <input type="hidden" name="display_override" class="form-control form-control-sm">

      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary">Lisää tapahtuma</button>
      </div>
      <div id="status" class="mt-3 text-center small"></div>
    </form>

    <script>
      document.getElementById('eventForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const status = document.getElementById('status');
        const submitBtn = e.target.querySelector('button');
        
        status.innerText = "Tallennetaan...";
        submitBtn.disabled = true;

        const formData = {};
        new FormData(e.target).forEach((value, key) => formData[key] = value);

        google.script.run
          .withSuccessHandler((msg) => {
            status.innerHTML = `<span class="text-success">${msg}</span>`;
            setTimeout(() => google.script.host.close(), 1500);
          })
          .withFailureHandler((err) => {
            status.innerHTML = `<span class="text-danger">Virhe: ${err}</span>`;
            submitBtn.disabled = false;
          })
          .processForm(formData);
      });
    </script>
  </body>
</html>